<!--
  Eclipse Public License - v 2.0

    THE ACCOMPANYING PROGRAM IS PROVIDED UNDER THE TERMS OF THIS ECLIPSE
    PUBLIC LICENSE ("AGREEMENT"). ANY USE, REPRODUCTION OR DISTRIBUTION
    OF THE PROGRAM CONSTITUTES RECIPIENT'S ACCEPTANCE OF THIS AGREEMENT.
-->

{#include support-layout}
    {#content}
        <div class="form-card">
            <h1>{title}</h1>
            <form method="post" action="{action}">
                <div>
                    <label>Username
                        <input type="text" name="name" value="{user.name}" required>
                    </label>
                </div>
                <div>
                    <label>Full Name
                        <input type="text" name="fullName" value="{user.fullName}">
                    </label>
                </div>
                <div>
                    <label>Email
                        <input type="email" name="email" value="{user.email}" required>
                    </label>
                </div>
                <div>
                    <label>Social
                        <input type="text" name="social" value="{user.social}">
                    </label>
                </div>
                <div>
                    <label>Phone Number
                        <input type="tel" name="phoneNumber" value="{user.phoneNumber}">
                    </label>
                </div>
                <div>
                    <label>Phone Extension
                        <input type="text" name="phoneExtension" value="{user.phoneExtension}">
                    </label>
                </div>
                <div>
                    <label>Country
                            {#countrySelect selectedCountry=user.country countries=countries /}
                    </label>
                </div>
                <div>
                    <label>Time Zone
                            {#timezoneSelect selectedTimezone=user.timezone timezones=timezones /}
                    </label>
                </div>
                <div>
                    <label>Type
                        <input type="text" value="User" readonly>
                        <input type="hidden" name="type" value="user">
                    </label>
                </div>
                <div>
                    <label>Company
                        {#if companyLocked?? && companyLocked}
                            <input type="text" value="{#for company in companies}{#if selectedCompanyId == company.id}{company.name}{/if}{/for}" readonly>
                            <input type="hidden" name="companyId" value="{selectedCompanyId}">
                        {#else}
                            <select name="companyId" required>
                                <option value="">Select a company</option>
                                {#for company in companies}
                                    <option value="{company.id}" {#if selectedCompanyId == company.id}selected{/if}>{company.name}</option>
                                {/for}
                            </select>
                        {/if}
                    </label>
                </div>
                <div>
                    <label>Password
                        <input type="password" name="password" required>
                    </label>
                </div>
                <div class="form-actions">
                    <button type="submit" class="action-button">Save</button>
                </div>
            </form>
        </div>
        <script>
            function loadTimezones() {
                var countryId = document.getElementById('countrySelect').value;
                var tzSelect = document.getElementById('timezoneSelect');
                tzSelect.innerHTML = '<option value="">Select time zone</option>';
                if (!countryId) return;
                fetch('/timezones?countryId=' + countryId)
                    .then(function(r) { return r.json(); })
                    .then(function(data) {
                        for (var i = 0; i < data.length; i++) {
                            var opt = document.createElement('option');
                            opt.value = data[i].id;
                            opt.textContent = data[i].name;
                            tzSelect.appendChild(opt);
                        }
                        if (data.length === 1) {
                            tzSelect.options[1].selected = true;
                        }
                    });
            }
        </script>
    {/content}
{/include}
