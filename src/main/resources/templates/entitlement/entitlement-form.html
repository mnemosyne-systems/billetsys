<!--
  Eclipse Public License - v 2.0

    THE ACCOMPANYING PROGRAM IS PROVIDED UNDER THE TERMS OF THIS ECLIPSE
    PUBLIC LICENSE ("AGREEMENT"). ANY USE, REPRODUCTION OR DISTRIBUTION
    OF THE PROGRAM CONSTITUTES RECIPIENT'S ACCEPTANCE OF THIS AGREEMENT.
-->

{#include admin-layout}
{#content}
<div class="form-card full-width">
    <h1>{title}</h1>
    <form method="post" action="{action}">
        <label>Name
            <input type="text" name="name" value="{entitlement.name}" required>
        </label>
        <div>
            <label class="markdown-label" for="entitlement-description">Description</label>
            <div class="markdown-editor" data-markdown-editor>
                <div class="markdown-toolbar" data-md-toolbar>
                    <button type="button" data-md-action="bold" aria-label="Bold"><strong>B</strong></button>
                    <button type="button" data-md-action="italic" aria-label="Italic"><em>I</em></button>
                    <button type="button" data-md-action="heading" aria-label="Heading">H</button>
                    <button type="button" data-md-action="list" aria-label="List">List</button>
                    <button type="button" data-md-action="quote" aria-label="Quote">Quote</button>
                    <button type="button" data-md-action="code" aria-label="Code"><code>{}</code></button>
                    <button type="button" data-md-action="code-block" aria-label="Code block">Code</button>
                    <button type="button" data-md-action="link" aria-label="Link">Link</button>
                </div>
                <div class="markdown-panels">
                    <div class="markdown-panel">
                        <div class="markdown-panel-header">Write</div>
                        <textarea id="entitlement-description" name="description" rows="6" required data-md-input>{entitlement.description}</textarea>
                    </div>
                    <div class="markdown-panel">
                        <div class="markdown-panel-header">Preview</div>
                        <div class="markdown-preview" data-md-preview></div>
                    </div>
                </div>
            </div>
        </div>
        <div style="display: grid; grid-template-columns: minmax(0, 1fr) auto minmax(0, 1fr); gap: 12px; align-items: start;">
            <div>
                <label>Available Levels</label>
                <select id="available-levels" multiple size="8" style="width: 100%;">
                    {#for level in supportLevels}
                    {#if !selectedLevelIds.contains(level.id)}
                    <option value="{level.id}">{level.name}</option>
                    {/if}
                    {/for}
                </select>
            </div>
            <div style="display: grid; gap: 8px; margin-top: 26px;">
                <button type="button" class="secondary-button" aria-label="Add level" onclick="moveSelected('available-levels', 'assigned-levels')">→</button>
                <button type="button" class="secondary-button" aria-label="Remove level" onclick="moveSelected('assigned-levels', 'available-levels')">←</button>
            </div>
            <div>
                <label>Assigned Levels</label>
                <select id="assigned-levels" name="levelIds" multiple size="8" style="width: 100%;">
                    {#for level in supportLevels}
                    {#if selectedLevelIds.contains(level.id)}
                    <option value="{level.id}" selected>{level.name}</option>
                    {/if}
                    {/for}
                </select>
            </div>
        </div>
        <div class="form-actions">
            <button type="submit" class="action-button">Save</button>
        </div>
    </form>
</div>
<script>
    function moveSelected(sourceId, targetId) {
        const source = document.getElementById(sourceId);
        const target = document.getElementById(targetId);
        if (!source || !target) {
            return;
        }
        const selected = Array.from(source.options).filter((option) => option.selected);
        selected.forEach((option) => {
            option.selected = true;
            target.appendChild(option);
        });
    }

    document.addEventListener("DOMContentLoaded", () => {
        const form = document.querySelector("form");
        const assigned = document.getElementById("assigned-levels");
        if (!form || !assigned) {
            return;
        }
        form.addEventListener("submit", () => {
            Array.from(assigned.options).forEach((option) => {
                option.selected = true;
            });
        });
    });
</script>
{/content}
{/include}
